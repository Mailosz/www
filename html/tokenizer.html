<!DOCTYPE html>
<html>
    <head>
        <title>Koloryzowanie sk≈Çadni</title>
        <meta charset="UTF-8">

        <style>
            .token:hover{
                background-color: rgba(127,127,127,0.3);
            }
        </style>
        <link rel="stylesheet" href="../css/langs/js-lang.css">
    </head>
    <body>
        <!-- contenteditable="true" onkeyup="change(this);" -->
        <code class="script" >
            

            let prepareFunction = (value) => {
                if (!this.functionsAllowed) {
                    throw "Functions are not allowed unless {allowFunctions: true} was specified in options. Only allow functions in languages from trusted sources.";
                }
    
                if (value instanceof Function) {
                    return value;
                } else if (value instanceof String) {
                    return new Function(value);
                } else {
                    return null;
                }
            }
    
            let arrayize = (data) => {
                if (Array.isArray(data)){
                    return data;
                } else {
                    return  [data];
                }
            }
    
            let appendToArray = (array, push) => {
                if (array === undefined){
                    array = [];
                }
    
                array.push(push);
                return array;
            }
    
            let forElementOrArray = (elOrAr, func) => {
                if (Array.isArray(elOrAr)){
                    for (const el of elOrAr){
                        func(el);
                    }
                } else {
                    func(elOrAr);
                }
            }
        </code>


        <script type="module">
            import {StringTokenizer, StringTokenizerLanguage, StringTokenizerLanguageService } from "../js/stringTokenizer/StringTokenizer.js";

            async function colorizeAll() {

                let language = await StringTokenizerLanguageService.getLanguageAsync("../js/StringTokenizer/js-simple.json");

                let elems = document.getElementsByClassName("script");

                for (let el of elems){
                    colorizeTextContent(el, language);
                }
            }

            function colorizeTextContent(element, language) {
                let text = element.textContent.split('\n');
                element.innerHTML = "";

                let tokenizer = new StringTokenizer(language);
                for (const line of text) {
                    tokenizer.resetText(line);

                    const lineElement = document.createElement("div");

                        while (!tokenizer.isFinished()) {
                        let token = tokenizer.getNextToken();

                        let span = document.createElement("span");
                        span.textContent = token.text;
                        span.classList.add("token");
                        if (token.data && token.data.color) {
                            span.style.color = token.data.color;
                        }
                        if (token.startData && token.startData.error) {
                            span.style.textDecoration = "1px wavy red underline";
                        }
                        if (token.data && token.data.class) {
                            span.classList.add(token.data.class);
                        } else {
                            span.classList.add(token.state);
                        }
                        span.title = token.state + "\n";

                        if (Object.values(token.data).length > 0) {
                            span.title += "\nData:\n";
                            for (const d in token.data) {
                                span.title += d + ": " + token.data[d] + "\n";
                            }
                        }

                        if (Object.values(token.values).length > 0) {
                            span.title += "\nValues:\n";
                            for (const d in token.values) {
                                span.title += d + ": " + token.values[d] + "\n";
                            }
                        }

                        lineElement.appendChild(span);
                    }
                    element.appendChild(lineElement);
                }
            }


            colorizeAll();
        </script>
    </body>
</html>